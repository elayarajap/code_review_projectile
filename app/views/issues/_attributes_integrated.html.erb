<%= labelled_fields_for :issue, @issue do |f| %>
<%= call_hook(:view_issues_form_details_top, { :issue => @issue, :form => f }) %>


<div class="oneColumn">
    
<% if @issue.safe_attribute? 'project_id' %>
<p class="selectBoxP"><%= f.select :project_id, project_tree_options_for_select(@issue.allowed_target_projects, :selected => @issue.project), {:required => true},
                :onchange => "updateIssueFrom('#{escape_javascript project_issue_form_path(@project, :id => @issue, :format => 'js')}')" %></p>
<% end %>


<% if @issue.safe_attribute? 'tracker_id' %>



<%= hidden_field_tag 'tracker_id', "1" %>

<% end %>

<div style="display:none;">
<% if @issue.safe_attribute? 'priority_id' %>
<p><%= f.select :priority_id, (@priorities.collect {|p| [p.name, p.id]}), {:required => true}, :disabled => !@issue.leaf? %></p>
<% end %>

<% if @issue.safe_attribute? 'assigned_to_id' %>
<p><%= f.select :assigned_to_id, principals_options_for_select(@issue.assignable_users, @issue.assigned_to), :include_blank => true, :required => @issue.required_attribute?('assigned_to_id') %></p>
<% end %>


</div>

<% if @issue.safe_attribute?('fixed_version_id') && @issue.assignable_versions_updated.any? %>
<p><%= f.select :fixed_version_id, version_options_for_select(@issue.assignable_versions_updated, @issue.fixed_version), :include_blank => true, :required => @issue.required_attribute?('fixed_version_id') %>

</p>
<% end %>


<% if @issue.safe_attribute? 'subject' %>
	<p><%= f.text_field :subject, :class => "addToInput", :size => 80, :maxlength => 255, :required => true %>
<% end %>


 <% if @issue.safe_attribute? 'description' %>
<p>
  <%= f.label_for_field :description, :required => @issue.required_attribute?('description') %>
  <%= link_to_function image_tag('edit.png'), '$(this).hide(); $("#issue_description_and_toolbar").show()' unless @issue.new_record? %>
  <%= content_tag 'span', :id => "issue_description_and_toolbar", :style => (@issue.new_record? ? nil : 'display:none') do %>
    <%= f.text_area :description,
                   :cols => 60,
                   :rows => (@issue.description.blank? ? 10 : [[10, @issue.description.length / 50].max, 100].min),
                   :accesskey => accesskey(:edit),
                   :class => 'wiki-edit',
                   :no_label => true %>
  <% end %>
</p>

<% end %>

<p id="attachments_form"  class="attachFilesDiv" >
  <label><%= l(:label_attachment_plural) %></label> 
  <span class="attachFileSpan">
    <%= render :partial => 'attachments/form', :locals => {:container => @issue} %>
  </span>  
</p>



<div class="splitcontent">
<div class="splitcontentleft ddLarge">
<% i = 0 %>
<% split_on = (@issue.custom_field_values.size / 2.0).ceil - 1 %>
<% @issue.editable_custom_field_values.each do |value| %>
  <p><%= custom_field_tag_with_label :issue, value, :required => @issue.required_attribute?(value.custom_field_id) %></p>
<% if i == split_on -%>
</div><div class="splitcontentright">
<% end -%>
<% i += 1 -%>
<% end -%>
</div>
</div>
<% if params["tid"]=="2" || params["tracker_id"]=="2" %>
  <% if @issue.safe_attribute?('fixed_version_id') && @issue.assignable_versions_updated.any? %>
    <%= submit_tag "Add Task", :class => "greenBtn" %>
  <% else %>
    <button type="submit" onclick="return false;" name="button" class="greenBtn grayBtn" disabled="disabled">Add Task</button>
  <%end%>
<% else %>
  <% if @issue.safe_attribute?('fixed_version_id') && @issue.assignable_versions_updated.any? %>
    <%= f.hidden_field :estimated_hours, :value => "0" %>
    <%= submit_tag "Post Bug", :class => "greenBtn new_issue_btn" %>
  <% else %>
    <button type="submit" onclick="return false;" name="button" class="greenBtn grayBtn" disabled="disabled">Post Bug</button>
  <%end%>
<% end %>
  </div>

  <%= call_hook(:view_issues_form_details_bottom, { :issue => @issue, :form => f }) %>
<% end %>
<script>
$(document).ready(function(){
$('#issue_fixed_version_id').val($('#values_fixed_version_id_1').val());

$("#issue_fixed_version_id option[value='']").remove();
 
   $('#issue_fixed_version_id').change(function(){  
      $('#values_fixed_version_id_1').val($(this).val());
      $('.filterBtn').click()
    });
});
</script>


