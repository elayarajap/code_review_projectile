<%= error_messages_for 'project' %>
<div class="splitContentDiv">
  <div class="box tabular">
  <!--[form:project]-->
    <p><%= f.text_field :name, :required => true, :size => 60 %></p>
    <p><%= f.text_area :description, :rows => 8, :class => 'wiki-edit' %></p>
    <p><%= f.text_field :identifier, :required => true, :size => 60, :disabled => @project.identifier_frozen?, :maxlength => Project::IDENTIFIER_MAX_LENGTH %>
    <% unless @project.identifier_frozen? %>
      <em class="info"><%= l(:text_length_between, :min => 1, :max => Project::IDENTIFIER_MAX_LENGTH) %> <%= l(:text_project_identifier_info).html_safe %></em>
    <% end %></p>

    <%if params.has_key?(:project_id)%>
    <p><%= f.text_field :estimated_hours,:required => true, :size => 60 %>&nbsp; Hours</p>
    <p><%= f.text_field :group_mail_address, :required => true, :size => 60 %></p>
    <p><%=f.select :project_type, options_for_select(["Retainer", "Fixed Bid", "T&M"], @project.project_type) %></p>
    <p><%=f.select :project_method, options_for_select(["Agile", "Waterfall", "Prototype", "Hybrid"], @project.project_method) %></p>
    <% elsif params.has_key?(:project) && params[:project].include?(:parent_id) && !params[:project]["parent_id"].nil? %>
    <p><%= f.text_field :estimated_hours,:required => true, :size => 60 %>&nbsp; Hours</p>
    <p><%= f.text_field :group_mail_address, :required => true, :size => 60 %></p>
    <p><%=f.select :project_type, options_for_select(["Retainer", "Fixed Bid", "T&M"], @project.project_type)%></p>
    <p><%=f.select :project_method, options_for_select(["Agile", "Waterfall", "Prototype", "Hybrid"], @project.project_method) %></p>
    <% elsif params.has_key?(:action) && params[:action].include?("settings") && params.has_key?(:id) %>
    <p><%= f.text_field :estimated_hours,:required => true, :size => 60 %>&nbsp; Hours</p>
    <p><%= f.text_field :group_mail_address, :required => true, :size => 60 %></p>
    <p><%=f.select :project_type, options_for_select(["Retainer", "Fixed Bid", "T&M"], @project.project_type)%></p>
    <p><%=f.select :project_method, options_for_select(["Agile", "Waterfall", "Prototype", "Hybrid"], @project.project_method)%></p>
    <% elsif params.has_key?(:_method) && params[:_method].include?("put") %>
    <p><%= f.text_field :estimated_hours,:required => true, :size => 60 %>&nbsp; Hours</p>
    <p><%= f.text_field :group_mail_address, :required => true, :size => 60 %></p>
    <p><%=f.select :project_type, options_for_select(["Retainer", "Fixed Bid", "T&M"], @project.project_type) %></p>
    <p><%=f.select :project_method, options_for_select(["Agile", "Waterfall", "Prototype", "Hybrid"], @project.project_method) %></p>
    <% else %>
    <%= hidden_field_tag 'project[group_mail_address]', 'no-reply@techaffinity.com' %> 
    <%= hidden_field_tag 'project[project_type]', 'NA' %> 
    <%= hidden_field_tag 'project[project_method]', 'NA' %>
    <%= hidden_field_tag 'project[estimated_hours]', '0' %>  
    <%end%>

    <p style="display:none;"><%= f.text_field :homepage, :size => 60 %></p>
    <p style="display:none;"><%= f.check_box :is_public %></p>


    <% unless @project.allowed_parents.compact.empty? %>        
          <%if params.has_key?(:project_id)%>
            <p><%= label(:project, :parent_id, l(:field_parent)) %>
            <%= params[:project_name]%></p>
            <%= hidden_field_tag 'project[parent_id]', params[:project_id] %> 
            <%= hidden_field_tag 'project[parent_name]', params[:project_name] %>  
          <% elsif !@custom_project_id.nil? %>
            <p><%= label(:project, :parent_id, l(:field_parent)) %>
            <% proj_id = @custom_project_id %>
            <% proj_name = @custom_project_name %>
            <%= proj_name %></p>
            <%= hidden_field_tag 'project[parent_id]', proj_id %> 
            <%= hidden_field_tag 'project[parent_name]', proj_name %>        
          <%end%>        
    <% end %>

    <% if @project.safe_attribute? 'inherit_members' %>
    <p><%= f.check_box :inherit_members %></p>
    <% end %>

    <%= wikitoolbar_for 'project_description' %>

    <% if(params.has_key?(:action) && params[:action].include?("settings") && params.has_key?(:id)) || (params.has_key?(:_method) && params[:_method].include?("put")) %>

    <% else %>

      <% @project.custom_field_values.each do |value| %>
            <%= f.hidden_field "custom_field_values_#{value.custom_field.id}", :value => value_by_format(value.custom_field.field_format), :name=> "#{:project}[custom_field_values][#{value.custom_field.id}]"%>
          <% end %>

    <% end %>

    <%= call_hook(:view_projects_form, :project => @project, :form => f) %>
  </div>
</div>
<!-- 

<p><label for="project_custom_field_values_51">Group Mail Address</label><input class="string_cf" id="project_custom_field_values_51" name="project[custom_field_values][51]" type="text" value=""></p> -->

<div style="display:none;">

<% if @project.new_record? %>
  <div class="splitContentDiv mediumLabelWidth">
    <div class="box tabular">
      <h3 class="subTitleHeader"><%= l(:label_module_plural) %></h3>
    <% Redmine::AccessControl.available_project_modules.each do |m| %>
        <label class="floating">
        <%= check_box_tag 'project[enabled_module_names][]', m, @project.module_enabled?(m), :id => "project_enabled_module_names_#{m}" %>
        <%= l_or_humanize(m, :prefix => "project_module_") %>
        </label>
    <% end %>
    <%= hidden_field_tag 'project[enabled_module_names][]', '' %>     
    <%= javascript_tag 'observeProjectModules()' %>
    </div>
  </div>
<% end %>


<% if @project.new_record? || @project.module_enabled?('issue_tracking') %>
<% unless @trackers.empty? %>
<div class="box tabular" id="project_trackers">
  <h3 class="subTitleHeader"><%=l(:label_tracker_plural)%></h3>
  <% @trackers.each do |tracker| %>
      <label class="floating">
      <%= check_box_tag 'project[tracker_ids][]', tracker.id, @project.trackers.include?(tracker) %>
      <%=h tracker %>
      </label>
  <% end %>
  <%= hidden_field_tag 'project[tracker_ids][]', '' %>
</div>
<% end %>

<% unless @issue_custom_fields.empty? %>
<fieldset class="box tabular" id="project_issue_custom_fields"><legend><%=l(:label_custom_field_plural)%></legend>
<% @issue_custom_fields.each do |custom_field| %>
    <label class="floating">
        <% if custom_field.name == "Severity" %>
          <%= check_box_tag 'project[issue_custom_field_ids][]', custom_field.id, :checked, {:id => "project_issue_custom_field_ids_#{custom_field.id}"} %>
        <%=h custom_field.name %>
        <% else %>
          <%= check_box_tag 'project[issue_custom_field_ids][]', custom_field.id, (@project.all_issue_custom_fields.include? custom_field), (custom_field.is_for_all? ? {:disabled => "disabled"} : {}) %>
          <%=h custom_field.name %>
        <% end %>
    </label>
<% end %>
<%= hidden_field_tag 'project[issue_custom_field_ids][]', '' %>
</fieldset>
<% end %>


</div>

<% end %>
<!--[eoform:project]-->

<% unless @project.identifier_frozen? %>
  <% content_for :header_tags do %>
    <%= javascript_include_tag 'project_identifier' %>
  <% end %>
<% end %>

<% if !User.current.admin? && @project.inherit_members? && @project.parent && User.current.member_of?(@project.parent) %>
  <%= javascript_tag do %>
    $(document).ready(function() {
      $("#project_inherit_members").change(function(){
        if (!$(this).is(':checked')) {
          if (!confirm("<%= escape_javascript(l(:text_own_membership_delete_confirmation)) %>")) {
            $("#project_inherit_members").attr("checked", true);
          }
        }
      });
    });
  <% end %>
<% end %>

<script>
$(document).ready(function() {
  $(".bool_cf").parent().remove();
  $("label:contains('cc')").parent().remove();

  <% unless @project.allowed_parents.compact.empty? %>        
    <%if params.has_key?(:project_id)%>
    $("#project_custom_field_values_31").val('<%= params[:project_name]%>');
    <% end %>
  <% end %>
//$("#project_parent_id").val("<%=params[:project_id]%>");
//$("#project_parent_id").attr("disabled",true)

$('#project_estimated_hours').keydown(function(e) {     
        // Ensure that it is a number and stop the keypress
        if(e.keyCode !=8) { //check if not backspace
          if(this.value.length > 4)
            return false;
          if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
              e.preventDefault();
          }
        }
        
     });

});
</script>
