<%= back_url_hidden_field_tag %>
<%= error_messages_for 'version' %>

<div class="box tabular">

<div id="versioninitdate" style="display:none;"><%= @version.init_date %></div>
<div id="versioneffectdate" style="display:none;"><%= @version.effective_date %></div>
<p><%= f.text_field :name, :size => 60, :required => true %></p>
<p><%= f.text_field :description, :size => 60%></p>
<p><%= f.select :status, Version::VERSION_STATUSES.collect {|s| [l("version_status_#{s}"), s]} %></p>
<p><%= f.text_field :wiki_page_title, :label => :label_wiki_page, :size => 60, :disabled => @project.wiki.nil? %></p>
<p><%= f.text_field :init_date, :size => 10 %><%= calendar_for('version_init_date') %></p>
<p><%= f.text_field :effective_date, :size => 10 %><%= calendar_for('version_effective_date') %></p>
<p><%= f.select :sharing, @version.allowed_sharings.collect {|v| [format_version_sharing(v), v]} %></p>

<% @version.custom_field_values.each do |value| %>
  <p><%= custom_field_tag_with_label :version, value %></p>
<% end %>

</div>
<script>
$(document).ready(function(){
  
  $(".addSprint").addClass("active");
  var myDate = new Date();
  var currentMonth = myDate.getMonth()+1;
  var currentDate = myDate.getDate();
  if(currentDate < 10) currentDate = '0' + currentDate; 
  if (currentMonth < 10) { currentMonth = '0' + currentMonth; }
  var prettyDate =myDate.getFullYear() + '-' + currentMonth + '-' + currentDate;

    $('.hasDatepicker').datepicker("option","minDate",null);
    $('.hasDatepicker').datepicker("option","maxDate",null);

  
    $('#version_init_date').val($('#versioninitdate').html());

    $('#version_effective_date').val($('#versioneffectdate').html());

    // $('#version_init_date').attr("disabled","disabled");
    // $('#version_effective_date').attr("disabled","disabled");
    // $('#version_effective_date').siblings('img').hide();

  $('#version_init_date').change(function()
  { 
      if($(this).val()!='')
      {
      var min_date = $('#version_init_date').val();
      $('#version_effective_date').datepicker("option","minDate",min_date);
      }
  });

  $('#version_effective_date').change(function()
  { 
      if($(this).val()!='')
      {
      var max_date = $('#version_effective_date').val();
      $('#version_init_date').datepicker("option","maxDate",max_date);
      }
  });

  $.datepicker._gotoToday = function(id) {
    var target = $(id);
    var inst = this._getInst(target[0]);
    if (this._get(inst, 'gotoCurrent') && inst.currentDay) {
            inst.selectedDay = inst.currentDay;
            inst.drawMonth = inst.selectedMonth = inst.currentMonth;
            inst.drawYear = inst.selectedYear = inst.currentYear;
    }
    else {
            var date = new Date();
            inst.selectedDay = date.getDate();
            inst.drawMonth = inst.selectedMonth = date.getMonth();
            inst.drawYear = inst.selectedYear = date.getFullYear();
            // the below two lines are new
            this._setDateDatepicker(target, date);
            this._selectDate(id, this._getDateDatepicker(target));
    }
    this._notifyChange(inst);
    this._adjustDate(target);
}


//$("#version_init_date").blur(function(e) { $(this).datepicker("hide"); });
//$("#version_effective_date").blur(function(e) { $(this).datepicker("hide"); });


});
</script>
